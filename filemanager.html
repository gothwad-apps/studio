<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gothwad File Manager</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- PRO UI --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-color); padding: 0; margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        .top-panel { padding: 15px 20px; background: var(--surface-color); border-bottom: 1px solid var(--border); z-index: 10; }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .proj-name { font-size: 18px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .back-btn { font-size: 20px; color: var(--text-sub); cursor: pointer; }
        
        .storage-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; display: flex; }
        .storage-fill { height: 100%; background: var(--primary); width: 35%; }
        .storage-label { font-size: 10px; color: var(--text-sub); margin-top: 5px; display: flex; justify-content: space-between; }

        .action-container { padding: 15px 20px 5px 20px; }
        .grid-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        
        .btn-card { 
            padding: 15px; border-radius: 12px; color: #fff; position: relative; 
            overflow: hidden; cursor: pointer; height: 90px; 
            display: flex; flex-direction: column; justify-content: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .btn-card:active { transform: scale(0.98); }

        /* COLORS */
        .bg-run { background: linear-gradient(135deg, #00c853, #64dd17); } /* Green for Run */
        .bg-apk { background: linear-gradient(135deg, #e65100, #ff9800); } /* Orange for APK */

        .card-icon { font-size: 24px; margin-bottom: 8px; }
        .card-lbl { font-size: 14px; font-weight: 700; }

        .add-bar { background: linear-gradient(135deg, #1565c0, #42a5f5); padding: 12px 20px; border-radius: 12px; color: white; display: flex; align-items: center; justify-content: space-between; font-weight: 600; font-size: 14px; cursor: pointer; box-shadow: 0 4px 12px rgba(21, 101, 192, 0.3); }

        .tools-row { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .breadcrumb { font-size: 14px; color: var(--text-sub); font-family: monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70%; }
        .breadcrumb span { color: var(--primary); font-weight: bold; }
        .tool-actions i { font-size: 16px; color: var(--text-main); margin-left: 18px; cursor: pointer; }

        .file-list-area { flex: 1; background: var(--surface-color); border-top-left-radius: 25px; border-top-right-radius: 25px; padding: 10px 0; overflow-y: auto; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        
        .file-item { display: flex; align-items: center; padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); animation: fadeInItem 0.3s forwards; opacity: 0; cursor: pointer; }
        .file-item:active { background: rgba(255,255,255,0.05); }
        
        .f-icon-box { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-right: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; }
        .f-details { flex: 1; }
        .f-title { font-size: 15px; font-weight: 500; color: var(--text-main); margin-bottom: 3px; }
        .f-meta { font-size: 11px; color: var(--text-sub); }
        .f-more { color: var(--text-sub); padding: 10px; font-size: 16px; cursor: pointer; }

        /* Loader */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 999; display: flex; justify-content: center; align-items: center; color: var(--primary); }
        
        /* Toast */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 12px; z-index: 600; display: none; }

        @keyframes fadeInItem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loading-overlay"><i class="fas fa-circle-notch fa-spin fa-2x"></i></div>

    <div class="top-panel">
        <div class="header-row">
            <i class="fas fa-arrow-left back-btn" onclick="window.location.href='home.html'"></i>
            <div class="proj-name"><i class="fas fa-cube" style="color:var(--primary)"></i> <span id="p-title">Loading...</span></div>
            <i class="fas fa-cog back-btn"></i>
        </div>
        <div class="storage-track"><div class="storage-fill"></div></div>
        <div class="storage-label"><span>Cloud Storage</span><span>Active</span></div>
    </div>

    <div class="action-container">
        <div class="grid-buttons">
            <div class="btn-card bg-run" onclick="runFullProject()">
                <i class="fas fa-play-circle card-icon"></i>
                <div class="card-lbl">Run Project</div>
            </div>
            <div class="btn-card bg-apk" onclick="showToast('ðŸ¤– APK Server Offline')">
                <i class="fab fa-android card-icon"></i>
                <div class="card-lbl">Build APK</div>
            </div>
        </div>
        
        <div class="add-bar" onclick="showToast('File Creation Locked in v1')">
            <span><i class="fas fa-plus-circle"></i> Create New File</span>
            <i class="fas fa-arrow-right"></i>
        </div>
    </div>

    <div class="tools-row">
        <div class="breadcrumb">root / src /</div>
        <div class="tool-actions"><i class="fas fa-sync-alt" onclick="location.reload()"></i></div>
    </div>

    <div class="file-list-area" id="file-list"></div>
    <div id="toast">Message</div>

    <script type="module">
        import { auth, db, doc, getDoc, onAuthStateChanged } from './firebase-config.js';

        const projectId = new URLSearchParams(window.location.search).get('id');
        const listEl = document.getElementById('file-list');
        const overlay = document.getElementById('loading-overlay');

        // Theme Restore
        let savedTheme = localStorage.getItem('gothwad_theme');
        if(savedTheme) document.body.classList.add(savedTheme);

        onAuthStateChanged(auth, async (user) => {
            if(!user) return window.location.href = "login.html";
            if(!projectId) return window.location.href = "home.html";

            try {
                const docRef = doc(db, "projects", projectId);
                const snap = await getDoc(docRef);

                if(snap.exists()) {
                    const data = snap.data();
                    document.getElementById('p-title').innerText = data.name;
                    
                    const projectFiles = [
                        { name: 'index.html', type: 'html', date: 'Main File' },
                        { name: 'style.css', type: 'css', date: 'Stylesheet' },
                        { name: 'script.js', type: 'js', date: 'Logic' }
                    ];

                    renderFiles(projectFiles);
                    overlay.style.display = 'none';
                } else {
                    alert("Project not found.");
                    window.location.href = "home.html";
                }
            } catch(e) {
                console.error(e);
                alert("Error loading files.");
            }
        });

        function renderFiles(files) {
            listEl.innerHTML = "";
            files.forEach((f, index) => {
                let icon = 'fa-file'; let color = '#aaa';
                if(f.type === 'html') { icon = 'fa-html5'; color = '#e44d26'; }
                else if(f.type === 'css') { icon = 'fa-css3-alt'; color = '#264de4'; }
                else if(f.type === 'js') { icon = 'fa-js'; color = '#f0db4f'; }

                let div = document.createElement('div');
                div.className = 'file-item';
                div.style.animationDelay = (index * 0.1) + 's';
                
                div.onclick = () => {
                    // Open Single File Editor
                    window.location.href = `editor.html?id=${projectId}&tab=${f.type}`;
                };

                div.innerHTML = `
                    <div class="f-icon-box"><i class="fas ${icon}" style="color:${color}"></i></div>
                    <div class="f-details">
                        <div class="f-title">${f.name}</div>
                        <div class="f-meta">${f.date}</div>
                    </div>
                    <i class="fas fa-chevron-right f-more" style="font-size:12px;"></i>
                `;
                listEl.appendChild(div);
            });
        }

        window.runFullProject = function() {
            // Opens the Full Preview (runs all files together)
            window.location.href = `preview.html?id=${projectId}`;
        }

        window.showToast = function(msg) {
            let t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }
    </script>
</body>
</html>
