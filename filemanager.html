<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gothwad File Manager</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- KEEPING THE SAME PRO LOOK --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-color);
            padding: 0; margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; flex-direction: column; height: 100vh;
            overflow: hidden;
        }

        /* Re-using previous CSS classes... */
        .top-panel { padding: 15px 20px; background: var(--surface-color); border-bottom: 1px solid var(--border); z-index: 10; }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .proj-name { font-size: 18px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .back-btn { font-size: 20px; color: var(--text-sub); cursor: pointer; }

        .storage-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; display: flex; }
        .storage-fill { height: 100%; background: var(--primary); width: 35%; }
        .storage-label { font-size: 10px; color: var(--text-sub); margin-top: 5px; display: flex; justify-content: space-between; }

        .action-container { padding: 15px 20px 5px 20px; }
        .grid-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        .btn-card { padding: 15px; border-radius: 12px; color: #fff; position: relative; overflow: hidden; cursor: pointer; height: 90px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-card:active { transform: scale(0.98); }
        .bg-zip { background: linear-gradient(135deg, #2e7d32, #66bb6a); }
        .bg-apk { background: linear-gradient(135deg, #e65100, #ff9800); }
        .card-icon { font-size: 22px; margin-bottom: 8px; }
        .card-lbl { font-size: 13px; font-weight: 700; }

        .add-bar { background: linear-gradient(135deg, #1565c0, #42a5f5); padding: 12px 20px; border-radius: 12px; color: white; display: flex; align-items: center; justify-content: space-between; font-weight: 600; font-size: 14px; cursor: pointer; box-shadow: 0 4px 12px rgba(21, 101, 192, 0.3); }

        .tools-row { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .breadcrumb { font-size: 14px; color: var(--text-sub); font-family: monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70%; }
        .breadcrumb span { color: var(--primary); font-weight: bold; }
        .tool-actions i { font-size: 16px; color: var(--text-main); margin-left: 18px; cursor: pointer; }

        .file-list-area { flex: 1; background: var(--surface-color); border-top-left-radius: 25px; border-top-right-radius: 25px; padding: 10px 0; overflow-y: auto; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .file-item { display: flex; align-items: center; padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); animation: fadeInItem 0.3s forwards; opacity: 0; }
        .file-item:active { background: rgba(255,255,255,0.05); }
        .f-icon-box { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-right: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; }
        .f-details { flex: 1; }
        .f-title { font-size: 15px; font-weight: 500; color: var(--text-main); margin-bottom: 3px; }
        .f-meta { font-size: 11px; color: var(--text-sub); }
        .f-more { color: var(--text-sub); padding: 10px; font-size: 16px; cursor: pointer; }

        /* --- âœ¨ NEW MODALS STYLES --- */
        
        /* 1. Create Modal (Custom Popup) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 500; display: none;
            justify-content: center; align-items: center;
        }
        .modal-box {
            width: 85%; max-width: 320px; background: var(--surface-color);
            border-radius: 16px; padding: 20px; border: 1px solid var(--border);
            animation: popIn 0.2s;
        }
        .modal-title { font-size: 16px; font-weight: 700; color: var(--text-main); margin-bottom: 15px; }
        
        /* Type Selector */
        .type-switch { display: flex; background: var(--bg-color); padding: 4px; border-radius: 8px; margin-bottom: 15px; }
        .type-btn { flex: 1; border: none; background: transparent; color: var(--text-sub); padding: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .type-btn.active { background: var(--surface-color); color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .modal-input { width: 100%; padding: 12px; background: var(--bg-color); border: 1px solid var(--border); border-radius: 8px; color: var(--text-main); margin-bottom: 20px; outline: none; }
        .modal-input:focus { border-color: var(--primary); }

        .modal-actions { display: flex; gap: 10px; }
        .m-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }
        .m-btn-cancel { background: transparent; color: var(--text-sub); border: 1px solid var(--border); }
        .m-btn-create { background: var(--primary); color: #fff; }

        /* 2. Image Preview Modal */
        .img-preview-box {
            max-width: 90%; max-height: 80%;
            background: transparent;
            display: flex; flex-direction: column; align-items: center;
        }
        .preview-img { width: 100%; height: auto; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .preview-close { margin-top: 20px; background: rgba(255,255,255,0.2); color: #fff; border: none; padding: 10px 20px; border-radius: 20px; backdrop-filter: blur(5px); }

        /* Toast */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 12px; z-index: 600; display: none; }

        @keyframes fadeInItem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

    <div class="top-panel">
        <div class="header-row">
            <!-- Back Button Logic: Agar folder me hain to upar jao, nahi to home -->
            <i class="fas fa-arrow-left back-btn" onclick="handleBack()"></i>
            <div class="proj-name"><i class="fas fa-cube" style="color:var(--primary)"></i> <span id="p-title">Project</span></div>
            <i class="fas fa-cog back-btn"></i>
        </div>
        <div class="storage-track">
            <div class="storage-fill"></div>
        </div>
        <div class="storage-label"><span>Local Storage</span><span>Ready</span></div>
    </div>

    <div class="action-container">
        <div class="grid-buttons">
            <div class="btn-card bg-zip" onclick="showToast('ðŸ“¦ Zipping...')"><i class="fas fa-file-archive card-icon"></i><div class="card-lbl">Export Zip</div></div>
            <div class="btn-card bg-apk" onclick="showToast('ðŸ¤– APK Build...')"><i class="fab fa-android card-icon"></i><div class="card-lbl">Build APK</div></div>
        </div>
        <div class="add-bar" onclick="openCreateModal()">
            <span><i class="fas fa-plus-circle"></i> Create New</span>
            <i class="fas fa-arrow-right"></i>
        </div>
    </div>

    <div class="tools-row">
        <!-- Breadcrumb: root > images -->
        <div class="breadcrumb" id="breadcrumbs">root /</div>
        <div class="tool-actions">
            <i class="fas fa-sync-alt" onclick="renderFiles()"></i>
        </div>
    </div>

    <div class="file-list-area" id="file-list"></div>

    <!-- 1. CREATE MODAL (Custom Popup) -->
    <div class="modal-overlay" id="createModal">
        <div class="modal-box">
            <div class="modal-title">Create New</div>
            
            <div class="type-switch">
                <button class="type-btn active" id="btn-file" onclick="setCreateType('file')">File</button>
                <button class="type-btn" id="btn-folder" onclick="setCreateType('folder')">Folder</button>
            </div>

            <input type="text" id="new-item-name" class="modal-input" placeholder="Enter name (e.g. style.css)">

            <div class="modal-actions">
                <button class="m-btn m-btn-cancel" onclick="closeCreateModal()">Cancel</button>
                <button class="m-btn m-btn-create" onclick="confirmCreate()">Create</button>
            </div>
        </div>
    </div>

    <!-- 2. IMAGE PREVIEW MODAL -->
    <div class="modal-overlay" id="imgModal" style="backdrop-filter: blur(5px);">
        <div class="img-preview-box">
            <img src="" id="preview-src" class="preview-img">
            <button class="preview-close" onclick="closeImgModal()">Close Preview</button>
        </div>
    </div>

    <div id="toast">Message</div>

    <!-- LOGIC -->
    <script>
        // Theme
        let savedTheme = localStorage.getItem('gothwad_theme');
        if(savedTheme) document.body.classList.add(savedTheme);

        // --- VIRTUAL FILE SYSTEM ---
        // 'parentId' use karke hum folder structure banayenge
        // 0 = Root Folder
        
        let currentFolderId = 0; 
        let folderHistory = []; // To track navigation for back button

        // Sample Data with IDs and ParentIDs
        let files = [
            { id: 1, parentId: 0, name: 'index.html', type: 'html', date: 'Just now' },
            { id: 2, parentId: 0, name: 'style.css', type: 'css', date: 'Yesterday' },
            { id: 3, parentId: 0, name: 'images', type: 'folder', date: '2 days ago' },
            { id: 4, parentId: 0, name: 'js', type: 'folder', date: 'Today' },
            // Inside 'images' (ID 3)
            { id: 101, parentId: 3, name: 'logo.png', type: 'img', date: '1 week ago' },
            { id: 102, parentId: 3, name: 'banner.jpg', type: 'img', date: '1 week ago' },
            // Inside 'js' (ID 4)
            { id: 201, parentId: 4, name: 'main.js', type: 'js', date: 'Just now' }
        ];

        const listEl = document.getElementById('file-list');
        const breadcrumbEl = document.getElementById('breadcrumbs');
        let createType = 'file'; // Default

        // --- RENDER FUNCTION ---
        function renderFiles() {
            listEl.innerHTML = "";
            
            // Filter files based on Current Folder ID
            let currentFiles = files.filter(f => f.parentId === currentFolderId);

            // Sort: Folders first
            currentFiles.sort((a, b) => (a.type === 'folder' ? -1 : 1));

            if(currentFiles.length === 0) {
                listEl.innerHTML = `<div style="text-align:center; padding:30px; color:#666; font-size:12px;">Folder is Empty</div>`;
                return;
            }

            currentFiles.forEach((f, index) => {
                let icon = 'fa-file'; let color = '#aaa';
                if(f.type === 'html') { icon = 'fa-html5'; color = '#e44d26'; }
                else if(f.type === 'css') { icon = 'fa-css3-alt'; color = '#264de4'; }
                else if(f.type === 'js') { icon = 'fa-js'; color = '#f0db4f'; }
                else if(f.type === 'folder') { icon = 'fa-folder'; color = '#ffd600'; }
                else if(f.type === 'img') { icon = 'fa-image'; color = '#9c27b0'; }

                let div = document.createElement('div');
                div.className = 'file-item';
                div.style.animationDelay = (index * 0.05) + 's';
                
                // Click Logic
                div.onclick = () => handleItemClick(f);

                div.innerHTML = `
                    <div class="f-icon-box"><i class="fas ${icon}" style="color:${color}"></i></div>
                    <div class="f-details">
                        <div class="f-title">${f.name}</div>
                        <div class="f-meta">${f.date}</div>
                    </div>
                    <i class="fas fa-ellipsis-v f-more"></i>
                `;
                listEl.appendChild(div);
            });
            updateBreadcrumb();
        }

        // --- CLICK HANDLING ---
        function handleItemClick(f) {
            if(f.type === 'folder') {
                // Enter Folder
                folderHistory.push(currentFolderId); // Save current ID
                currentFolderId = f.id; // New ID
                renderFiles();
            } else if (f.type === 'img') {
                // Show Image Preview
                openImgModal(f.name);
            } else {
                // Open Editor
                window.location.href = "editor.html?file=" + f.name;
            }
        }

        function handleBack() {
            if(folderHistory.length > 0) {
                // Go Up One Level
                currentFolderId = folderHistory.pop();
                renderFiles();
            } else {
                // Go to Dashboard
                window.location.href = "home.html";
            }
        }

        function updateBreadcrumb() {
            if(currentFolderId === 0) {
                breadcrumbEl.innerHTML = `root /`;
            } else {
                // Find folder name (Simplified for 1 level depth display)
                let currentFolder = files.find(f => f.id === currentFolderId);
                let name = currentFolder ? currentFolder.name : 'unknown';
                breadcrumbEl.innerHTML = `root / <span>${name}</span> /`;
            }
        }

        // --- CREATE MODAL LOGIC ---
        function openCreateModal() {
            document.getElementById('createModal').style.display = 'flex';
            document.getElementById('new-item-name').focus();
        }
        function closeCreateModal() {
            document.getElementById('createModal').style.display = 'none';
            document.getElementById('new-item-name').value = '';
        }

        function setCreateType(type) {
            createType = type;
            document.getElementById('btn-file').classList.toggle('active', type === 'file');
            document.getElementById('btn-folder').classList.toggle('active', type === 'folder');
        }

        function confirmCreate() {
            let name = document.getElementById('new-item-name').value;
            if(!name) { showToast("Enter a name!"); return; }

            // Determine Icon Type
            let finalType = createType;
            if(createType === 'file') {
                if(name.endsWith('.html')) finalType = 'html';
                else if(name.endsWith('.css')) finalType = 'css';
                else if(name.endsWith('.js')) finalType = 'js';
            }

            // Add to Files Array
            files.push({
                id: Date.now(),
                parentId: currentFolderId, // Create inside current folder
                name: name,
                type: finalType,
                date: 'Just now'
            });

            renderFiles();
            closeCreateModal();
            showToast(createType === 'folder' ? "Folder Created" : "File Created");
        }

        // --- IMAGE PREVIEW LOGIC ---
        function openImgModal(filename) {
            // Demo Image (Use filename logic in real app)
            // Using a placeholder for now as we don't have real files
            document.getElementById('preview-src').src = "https://via.placeholder.com/300x200.png?text=" + filename;
            document.getElementById('imgModal').style.display = 'flex';
        }
        function closeImgModal() {
            document.getElementById('imgModal').style.display = 'none';
        }

        function showToast(msg) {
            let t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        renderFiles();
    </script>
</body>
</html>