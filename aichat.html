<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Assistant - Gothwad Studio</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- ðŸ›  GLOBAL STYLES --- */
        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; /* Full Viewport Height */
            height: 100dvh; /* Mobile browser address bar fix */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
        }

        /* 1. HEADER */
        .app-bar {
            height: 60px;
            background: var(--surface-color);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 100;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0; /* Header shrink nahi hoga */
        }

        .header-left { display: flex; align-items: center; gap: 10px; flex: 1; overflow: hidden; }
        .icon-btn { background: none; border: none; font-size: 20px; color: var(--text-main); cursor: pointer; padding: 5px; }
        
        .page-info { display: flex; flex-direction: column; }
        .page-title { font-size: 16px; font-weight: 700; color: var(--text-main); margin: 0; white-space: nowrap; }
        
        .ai-status { font-size: 10px; color: #00e676; display: flex; align-items: center; gap: 5px; }
        .dot { width: 6px; height: 6px; background: #00e676; border-radius: 50%; animation: pulse 1.5s infinite; }

        .header-right { display: flex; gap: 15px; flex-shrink: 0; }

        /* SEARCH OVERLAY */
        .search-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            background: var(--surface-color); display: none; align-items: center; padding: 0 10px; z-index: 101; 
        }
        .search-input { width: 100%; padding: 10px; border: none; background: transparent; font-size: 16px; outline: none; color: var(--text-main); }

        /* 2. CHAT AREA (SCROLL FIX) */
        .chat-container {
            flex: 1; /* Bachi hui jagah lega */
            overflow-y: auto; /* Scroll sirf yahan hoga */
            padding: 15px;
            padding-bottom: 20px;
            display: flex; flex-direction: column; gap: 15px;
            scroll-behavior: smooth;
        }

        /* Messages */
        .msg-row { display: flex; gap: 10px; max-width: 90%; align-items: flex-end; }
        
        .avatar {
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; flex-shrink: 0;
        }
        .ai-avatar { background: linear-gradient(135deg, #00c6ff, #0072ff); color: white; box-shadow: 0 2px 5px rgba(0,114,255,0.3); }
        .user-avatar { background: var(--surface-color); color: var(--text-sub); border: 1px solid var(--border); }

        .bubble {
            padding: 10px 14px; border-radius: 18px;
            font-size: 14px; line-height: 1.5;
            position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            word-wrap: break-word;
        }

        .msg-ai { align-self: flex-start; }
        .msg-ai .bubble { background: var(--surface-color); color: var(--text-main); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .msg-user { align-self: flex-end; flex-direction: row-reverse; }
        .msg-user .bubble { background: linear-gradient(135deg, #00c6ff, #0072ff); color: #fff; border-bottom-right-radius: 4px; }

        /* Code Blocks */
        pre {
            background: #1e1e1e; color: #d4d4d4;
            padding: 10px; border-radius: 8px;
            overflow-x: auto; font-family: monospace;
            margin-top: 5px; font-size: 12px; border: 1px solid #333;
        }

        /* 3. FOOTER (Input Area) */
        .input-area {
            background: var(--surface-color);
            padding: 8px 10px;
            display: flex; align-items: center; gap: 10px;
            border-top: 1px solid var(--border);
            flex-shrink: 0; /* Footer shrink nahi hoga */
        }

        /* Icons */
        .action-icon {
            font-size: 20px; color: var(--text-sub); padding: 8px; cursor: pointer; transition: 0.2s;
        }
        .action-icon.active { color: #00e676; transform: scale(1.1); } /* Code Mode Active */

        .ai-input {
            flex: 1; padding: 10px 15px; border-radius: 20px;
            border: 1px solid var(--border); background: var(--bg-color);
            color: var(--text-main); outline: none; font-size: 14px;
            height: 40px;
        }
        
        .send-btn {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            color: #fff; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; cursor: pointer; flex-shrink: 0;
        }

        #fileInput { display: none; }

        /* 4. NAV */
        .bottom-nav {
            height: 60px;
            background: var(--surface-color);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-sub); text-decoration: none; height: 100%; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 500; }
        .nav-item.active { color: #0072ff; }

        /* Loading Dots */
        .typing { display: inline-block; width: 5px; height: 5px; background: #888; border-radius: 50%; margin: 0 2px; animation: bounce 1s infinite; }
        .typing:nth-child(2) { animation-delay: 0.2s; }
        .typing:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="app-bar">
        <div class="header-left">
            <button class="icon-btn" onclick="window.location.href='home.html'"><i class="fas fa-arrow-left"></i></button>
            <div class="page-info">
                <div class="page-title">Vibe Coding AI</div>
                <div class="ai-status"><div class="dot"></div> Online</div>
            </div>
        </div>
        
        <div class="header-right">
            <button class="icon-btn" onclick="toggleSearch()"><i class="fas fa-search"></i></button>
            <!-- Settings Link Updated -->
            <button class="icon-btn" onclick="window.location.href='aisettings.html'"><i class="fas fa-cog"></i></button>
        </div>

        <!-- Hidden Search -->
        <div class="search-container" id="searchBox">
            <button class="icon-btn" onclick="toggleSearch()"><i class="fas fa-arrow-left"></i></button>
            <input type="text" id="searchInput" class="search-input" placeholder="Search chat history...">
        </div>
    </header>

    <!-- CHAT CONTAINER -->
    <div class="chat-container" id="chatBox">
        <div class="msg-row msg-ai">
            <div class="avatar ai-avatar"><i class="fas fa-robot"></i></div>
            <div class="bubble">
                Hello Dev! ðŸ¤–<br>
                Tap the <b>Code Icon (<i class="fas fa-code"></i>)</b> below if you want me to generate code snippets only.
            </div>
        </div>
    </div>

    <!-- FOOTER INPUT -->
    <div class="input-area">
        <!-- 1. File Upload -->
        <i class="fas fa-paperclip action-icon" onclick="document.getElementById('fileInput').click()"></i>
        <input type="file" id="fileInput" onchange="handleFileUpload(this)">

        <!-- 2. Code Mode Toggle -->
        <i class="fas fa-code action-icon" id="codeBtn" onclick="toggleCodeMode()"></i>

        <!-- 3. Input -->
        <input type="text" id="userInput" class="ai-input" placeholder="Ask AI to code...">
        
        <!-- 4. Send -->
        <button class="send-btn" onclick="sendAI()"><i class="fas fa-magic"></i></button>
    </div>

    <!-- NAV -->
    <nav class="bottom-nav">
        <a href="home.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="explore.html" class="nav-item"><i class="fas fa-compass"></i><span>Explore</span></a>
        <a href="globalchat.html" class="nav-item"><i class="fas fa-users"></i><span>Global</span></a>
        <a href="chat.html" class="nav-item"><i class="fas fa-comment-dots"></i><span>DM</span></a>
        <a href="#" class="nav-item active"><i class="fas fa-robot"></i><span>AI</span></a>
    </nav>

    <!-- LOGIC -->
    <script>
        const chatBox = document.getElementById('chatBox');
        const input = document.getElementById('userInput');
        const codeBtn = document.getElementById('codeBtn');
        
        let isCodeMode = false; // Toggle State

        // Theme Load
        let savedTheme = localStorage.getItem('gothwad_theme');
        if(savedTheme) document.body.className = savedTheme;

        // --- 1. Toggle Code Mode ---
        function toggleCodeMode() {
            isCodeMode = !isCodeMode;
            if(isCodeMode) {
                codeBtn.classList.add('active'); // Green
                input.placeholder = "Describe the code you need...";
            } else {
                codeBtn.classList.remove('active'); // Grey
                input.placeholder = "Ask AI to code...";
            }
        }

        // --- 2. Send Function ---
        function sendAI() {
            let text = input.value.trim();
            if(!text) return;

            // User Bubble
            addMessage(text, 'user');
            input.value = '';

            let id = showTyping();

            setTimeout(() => {
                removeTyping(id);
                // Agar Code Mode ON hai, toh Smart Response sirf Code dega
                let reply = getSmartResponse(text.toLowerCase(), isCodeMode);
                addMessage(reply, 'ai');
            }, 1200);
        }

        // --- 3. Smart Logic ---
        function getSmartResponse(q, codeOnly) {
            // Agar Code Mode ON hai, toh formatting change karo
            if(codeOnly) {
                return `Generated Code:<br><pre>// Code for: ${q}
function example() {
  console.log("Mode: Code Only");
  return true;
}</pre>`;
            }

            // Normal Logic
            if(q.includes('html')) {
                return `HTML Snippet:\n<pre>&lt;div class="box"&gt;\n  Content Here\n&lt;/div&gt;</pre>`;
            }
            if(q.includes('css')) {
                return `CSS Style:\n<pre>.box { color: red; }</pre>`;
            }
            if(q.includes('js')) {
                return `JS Function:\n<pre>console.log("Hello");</pre>`;
            }
            return "I can create HTML, CSS, JS. Turn on <i class='fas fa-code'></i> mode for pure code.";
        }

        // --- 4. UI Helpers ---
        function addMessage(html, type) {
            let div = document.createElement('div');
            div.className = `msg-row msg-${type}`;
            
            let avatarClass = type === 'ai' ? 'ai-avatar' : 'user-avatar';
            let avatarIcon = type === 'ai' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';

            div.innerHTML = `
                <div class="avatar ${avatarClass}">${avatarIcon}</div>
                <div class="bubble">${html}</div>
            `;
            chatBox.appendChild(div);
            scrollToBottom();
        }

        function showTyping() {
            let id = "typing-" + Date.now();
            let div = document.createElement('div');
            div.id = id;
            div.className = 'msg-row msg-ai';
            div.innerHTML = `
                <div class="avatar ai-avatar"><i class="fas fa-robot"></i></div>
                <div class="bubble">
                    <span class="typing"></span><span class="typing"></span><span class="typing"></span>
                </div>
            `;
            chatBox.appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeTyping(id) {
            let el = document.getElementById(id);
            if(el) el.remove();
        }

        // --- 5. Scroll Fix ---
        function scrollToBottom() {
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // --- 6. Extra Features ---
        window.toggleSearch = function() {
            let box = document.getElementById('searchBox');
            if(box.style.display === 'flex') {
                box.style.display = 'none';
            } else {
                box.style.display = 'flex';
                document.getElementById('searchInput').focus();
            }
        }

        window.handleFileUpload = function(input) {
            if(input.files.length > 0) {
                let fileName = input.files[0].name;
                addMessage(`ðŸ“‚ <b>File:</b> ${fileName}`, 'user');
                setTimeout(() => addMessage(`I see you uploaded <b>${fileName}</b>. Parsing...`, 'ai'), 1000);
            }
        }

        input.addEventListener("keypress", (e) => { if(e.key === "Enter") sendAI(); });

    </script>
</body>
</html>