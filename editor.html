<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Editor - Gothwad Studio</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ace Editor CDN (The Brain) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.js"></script>

    <style>
        /* --- ‚å®Ô∏è IDE STYLES --- */
        body {
            background-color: #1e1e1e;
            margin: 0; padding: 0;
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; /* No scroll on body */
        }

        /* 1. TOP HEADER */
        .ide-header {
            height: 50px; background: #252526;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; border-bottom: 1px solid #333;
        }

        .file-info { display: flex; align-items: center; gap: 10px; color: #ccc; font-size: 14px; font-weight: bold; }
        .back-icon { padding: 10px; cursor: pointer; }

        .ide-actions { display: flex; gap: 10px; }
        
        /* Run Button (Green Play) */
        .btn-run {
            background: #2e7d32; color: #fff; border: none;
            padding: 6px 15px; border-radius: 4px; font-size: 12px;
            display: flex; align-items: center; gap: 5px; cursor: pointer;
        }
        .btn-save {
            background: #007acc; color: #fff; border: none;
            padding: 8px; border-radius: 4px; cursor: pointer;
        }

        /* 2. TAB BAR (File Switcher) */
        .tab-bar {
            height: 35px; background: #1e1e1e; display: flex;
            border-bottom: 1px solid #333; overflow-x: auto;
        }
        .tab {
            padding: 0 15px; display: flex; align-items: center; gap: 8px;
            font-size: 13px; color: #888; border-right: 1px solid #333;
            cursor: pointer; min-width: 100px;
        }
        .tab.active { background: #1e1e1e; color: #fff; border-top: 2px solid var(--primary); }
        .tab-icon { font-size: 14px; }
        .unsaved-dot { width: 8px; height: 8px; background: #fff; border-radius: 50%; display: none; }
        .tab.unsaved .unsaved-dot { display: block; }

        /* 3. EDITOR AREA */
        #editor-container {
            flex: 1; position: relative;
        }
        #editor { 
            position: absolute; top: 0; right: 0; bottom: 0; left: 0; 
            font-size: 14px; line-height: 20px;
        }

        /* 4. KEYBOARD HELPER (Quick Keys) */
        .quick-keys {
            height: 45px; background: #2d2d2d;
            display: flex; align-items: center; gap: 5px;
            padding: 0 5px; overflow-x: auto;
            border-top: 1px solid #333;
        }
        .key-btn {
            min-width: 40px; height: 35px;
            background: #3c3c3c; border: none; color: #fff;
            border-radius: 4px; font-family: monospace; font-size: 16px;
            cursor: pointer;
        }
        .key-btn:active { background: var(--primary); }

        /* 5. PREVIEW WINDOW (Overlay) */
        #preview-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 100; display: none;
            flex-direction: column;
        }
        .preview-header {
            height: 50px; background: #f5f5f5; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center; padding: 0 15px;
        }
        .preview-title { font-weight: bold; color: #333; font-size: 14px; }
        .close-preview { color: #ff4444; font-size: 24px; cursor: pointer; }
        
        iframe { flex: 1; border: none; width: 100%; background: #fff; }

        /* Console Drawer */
        #console-drawer {
            height: 150px; background: #222; color: #0f0;
            border-top: 1px solid #444; padding: 10px;
            font-family: monospace; font-size: 12px; overflow-y: auto;
            display: none;
        }

    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="ide-header">
        <div class="file-info">
            <i class="fas fa-arrow-left back-icon" onclick="history.back()"></i>
            <span id="current-filename">index.html</span>
        </div>
        <div class="ide-actions">
            <button class="btn-save" onclick="saveCode()"><i class="fas fa-save"></i></button>
            <button class="btn-run" onclick="runCode()"><i class="fas fa-play"></i> RUN</button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('html')">
            <i class="fab fa-html5 tab-icon" style="color: #e44d26;"></i> index.html
            <div class="unsaved-dot"></div>
        </div>
        <div class="tab" onclick="switchTab('css')">
            <i class="fab fa-css3-alt tab-icon" style="color: #264de4;"></i> style.css
        </div>
        <div class="tab" onclick="switchTab('js')">
            <i class="fab fa-js tab-icon" style="color: #f0db4f;"></i> script.js
        </div>
    </div>

    <!-- EDITOR -->
    <div id="editor-container">
        <div id="editor"></div>
    </div>

    <!-- QUICK KEYS -->
    <div class="quick-keys">
        <button class="key-btn" onclick="insertKey('<')">&lt;</button>
        <button class="key-btn" onclick="insertKey('>')">&gt;</button>
        <button class="key-btn" onclick="insertKey('/')">/</button>
        <button class="key-btn" onclick="insertKey('=')">=</button>
        <button class="key-btn" onclick="insertKey('"')">"</button>
        <button class="key-btn" onclick="insertKey('{')">{</button>
        <button class="key-btn" onclick="insertKey('}')">}</button>
        <button class="key-btn" onclick="insertKey(';')">;</button>
        <button class="key-btn" onclick="insertKey('!')">!</button>
        <button class="key-btn" onclick="insertKey('class')">class</button>
        <button class="key-btn" onclick="insertKey('id')">id</button>
    </div>

    <!-- PREVIEW OVERLAY -->
    <div id="preview-overlay">
        <div class="preview-header">
            <span class="preview-title">Live Preview (Pixel 5)</span>
            <div style="display:flex; gap:15px; align-items:center;">
                <i class="fas fa-terminal" style="color:#666; cursor:pointer;" onclick="toggleConsole()"></i>
                <i class="fas fa-times close-preview" onclick="closePreview()"></i>
            </div>
        </div>
        <iframe id="output-frame"></iframe>
        <div id="console-drawer">
            <div>> Gothwad Console initialized...</div>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // 1. SETUP ACE EDITOR
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai"); // Dark Theme
        editor.session.setMode("ace/mode/html");
        editor.setFontSize(14);
        editor.setShowPrintMargin(false);
        editor.setOptions({
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
            showLineNumbers: true,
            tabSize: 2
        });

        // Mock Data (Real app me localStorage se aayega)
        let files = {
            html: `<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Hello Gothwad!</h1>
    <p>Start coding now...</p>
    <button onclick="msg()">Click Me</button>

    <script src="script.js"><\/script>
</body>
</html>`,
            css: `body {
    background: #121212;
    color: #fff;
    font-family: sans-serif;
    text-align: center;
    padding-top: 50px;
}
button {
    padding: 10px 20px;
    background: #bb86fc;
    border: none;
    color: #000;
    font-weight: bold;
}`,
            js: `function msg() {
    alert("Gothwad Studio is Awesome!");
    console.log("Button clicked!");
}`
        };

        let currentMode = 'html';

        // Set initial content
        editor.setValue(files.html, -1); // -1 moves cursor to start

        // 2. TAB SWITCHING
        function switchTab(type) {
            // Save current work to variable before switching
            files[currentMode] = editor.getValue();

            // Change Active Tab UI
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Change Editor Mode & Content
            currentMode = type;
            if(type === 'html') editor.session.setMode("ace/mode/html");
            if(type === 'css') editor.session.setMode("ace/mode/css");
            if(type === 'js') editor.session.setMode("ace/mode/javascript");

            editor.setValue(files[type], -1);
            
            // Update Filename in Header
            let names = {html: 'index.html', css: 'style.css', js: 'script.js'};
            document.getElementById('current-filename').innerText = names[type];
        }

        // 3. KEYBOARD HELPER
        function insertKey(text) {
            editor.insert(text);
            editor.focus();
        }

        // 4. RUN CODE (The Magic)
        function runCode() {
            // Save current state
            files[currentMode] = editor.getValue();

            let html = files.html;
            let css = "<style>" + files.css + "</style>";
            let js = "<script>" + files.js + "<\/script>";

            // Inject CSS & JS into HTML
            // Note: Simplistic injection. For real app, use Blob URL.
            let previewContent = html.replace('</head>', css + '</head>').replace('</body>', js + '</body>');

            let iframe = document.getElementById('output-frame');
            let doc = iframe.contentDocument || iframe.contentWindow.document;
            
            doc.open();
            doc.write(previewContent);
            doc.close();

            // Override Console log in iframe to show in our drawer
            iframe.contentWindow.console.log = function(message) {
                let drawer = document.getElementById('console-drawer');
                drawer.innerHTML += `<div>> ${message}</div>`;
                drawer.scrollTop = drawer.scrollHeight;
            }

            document.getElementById('preview-overlay').style.display = 'flex';
        }

        function closePreview() {
            document.getElementById('preview-overlay').style.display = 'none';
        }

        function toggleConsole() {
            let drawer = document.getElementById('console-drawer');
            drawer.style.display = drawer.style.display === 'block' ? 'none' : 'block';
        }

        // 5. SAVE (To LocalStorage)
        function saveCode() {
            files[currentMode] = editor.getValue();
            // Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('id') || 'temp';
            
            localStorage.setItem('gothwad_code_' + projectId, JSON.stringify(files));
            alert("Saved Locally! üíæ");
        }

        // Check for Auto-Load
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');
        let savedData = localStorage.getItem('gothwad_code_' + projectId);
        if(savedData) {
            files = JSON.parse(savedData);
            editor.setValue(files.html, -1);
        }

    </script>
</body>
</html>